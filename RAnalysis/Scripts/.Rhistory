Env <- read.csv("Envt.csv",header=TRUE, sep=",", na.strings="NA") #Read in environmental data
ID <- Env$Sample          #sample ID
cspecies <- Env$Species   #coral species
Site <-Env$Site           #Collection Site
RSD <-Env$RSD           #Record SD in Temperature
RVAR <-Env$RVAR           #Record Range in Temperature
RMean <-Env$RMean           #Record Mean Temperature
RMax <-Env$RMax           #Record Max in Temperature
RMin <-Env$RMin           #Record Min in Temperature
DSD <-Env$DSD           #Daily SD in Temperature
DVAR <-Env$DVAR            #Daily Varience in Temperature
DRange <-Env$DRange           #Daily Range in Temperature
DMean <-Env$DMean           #Daily Mean in Temperature
DMax <-Env$DMax           #Daily Max in Temperature
DMin <-Env$DMin           #Daily Min in Temperature
Canonical Correspondence Analysis (CCA)
Full Model
SymAS <- read.csv("Moorea_97otu_table.csv", header=TRUE, row.names=1, sep=",")  #read in sym "OTU" data with species and sample ID
SymAS <- SymAS[,-1]
SymASP <- SymAS/rowSums(SymAS) #Relative Abundance
N <- rowSums(SymASP)
SymASP.cca <- cca(SymASP ~ Species + RMin + RMax + RRange + RVAR + RSD + DMin + DMax + DRange + DVAR + DSD, data=Env)
SymASP.cca <- cca(SymASP ~ Species + RMean + RMin + RMax + RVAR, data=Env)
anova(SymASP.cca)
anova(SymASP.cca, by="terms")
Plot, label, and color
ordiplot(SymASP.cca, scaling=1)
with(Env, levels(Species))
colvec <- c("blue", "orange")
with(Env, points(SymASP.cca, col = colvec[Species], scaling=1, pch = 16, bg = colvec[Species]))
with(Env, legend("topright", legend = levels(Species), bty = "n",col = colvec, pch = 16, pt.bg = colvec))
rm (list = ls ()) #clears all variables
Read in libraries
library("gplots")
library("vegan")
Set working directory and read in temp data for processing
mainDir <- '/Users/hputnam/Publications/In_Prep/Moorea_NGS/RAnalysis' #path on local computer
setwd(file.path(mainDir, 'Scripts')) #changes working directory to scripts
setwd(file.path(mainDir, 'Data')) #changes working directory to data
Read in data
SymAS <- read.csv("20140206_Moorea_Output.csv", header=TRUE, sep=",")  #read in sym "OTU" data with species and sample ID
head(SymAS)
rownames(SymAS)
colnames(SymAS)
SymAS <- SymAS [,-1]
N <- rowSums(SymAS)
S <
SymAS <- read.csv("20140206_Moorea_Output.csv", header=TRUE, sep=",")  #read in sym "OTU" data with species and sample ID
setwd(file.path(mainDir, 'Data')) #changes working directory to data
Moorea 2009 data analysis file Moorea2009.R
Code by HM Putnam
Data and Code Curated by HM Putnam hollieputnam@gmail.com
Last edited 20131003
This code extracts temperature metrics from timeseries seawater temperature data and generates a metric table, reads symbiont diversity tables, carries out rarefaction, plots rarefied data, carries out Cannonical Correspondance analysis, and plots CCA triplots of symbiont diveristy on environmental metrics.
Copyright 2013 HM Putnam
Use of this code must be accompanied by a citation to X
Data should not be used without permission from HM Putnam
rm (list = ls ()) #clears all variables
Read in libraries
library("gplots")
library("vegan")
Set working directory and read in temp data for processing
mainDir <- '/Users/hputnam/Publications/In_Prep/Moorea_NGS/RAnalysis' #path on local computer
setwd(file.path(mainDir, 'Scripts')) #changes working directory to scripts
setwd(file.path(mainDir, 'Data')) #changes working directory to data
SymAS <- read.csv("20140206_Moorea_Output.csv", header=TRUE, sep=",")  #read in sym "OTU" data with species and sample ID
pwd
getwd
getwd()
rm (list = ls ()) #clears all variables
Read in libraries
library("gplots")
library("vegan")
Set working directory and read in temp data for processing
mainDir <- '/Users/hputnam/Publications/In_Prep/Moorea_NGS/RAnalysis' #path on local computer
setwd(file.path(mainDir, 'Scripts')) #changes working directory to scripts
setwd(file.path(mainDir, 'Data')) #changes working directory to data
rm (list = ls ()) #clears all variables
Set working directory and read in temp data for processing
mainDir <- '/Users/hputnam/Publications/In_Prep/Moorea_NGS/RAnalysis' #path on local computer
setwd(file.path(mainDir, 'Data')) #changes working directory to data
read in count data
SymAS2 <- read.csv("20140206_Moorea_OTUs.csv", header=TRUE, row.names=1, sep=",")  #read in sym "OTU" data with species and sample ID
SymAS2 # check data
read in enviornmental data
sampleInfo <- read.table("Moorea_Envt.txt", header=TRUE, sep="\t", as.is=TRUE)
sampleInfo  # look at it, does it look like it came in correctly?
class(sampleInfo)  # what type of object is it?
colnames(sampleInfo)  # what are the names of the columns / fields?
attach(sampleInfo)
head(SymAS2)   # quick check -- does it look okay?
rownames(SymAS2)  # check the names of the rows
colnames(SymAS2)  # check the names of the columns
SampleName  #  Notice that the sample names in the metadata file are in the same order as the column names!
Lets look at the abundances from the first sample (LOP_20110110)
head(sort(SymAS2[,1])) # what kind of abundances do we see?
?sort                       # what if I want to sort decreasing? Get help on the syntax also help(sort)
sort(SymAS2[,1], decreasing=TRUE)  # Rank abundance for the data, but it includes 0's
sort(SymAS2[SymAS2[,1]>0,1], decreasing=TRUE)  # Proper rank abundance with all the rows from cloumn 1 that are greater than 0
myRankAbund <- sort(SymAS2[SymAS2[,1]>0,1], decreasing=TRUE)  # Save the rank abundance for the first sample
table(SymAS2[SymAS2[,1] > 0 ,1])  # But John Bunge and real biologists prefer Species abundances, table provides the frequencies of each value (count)
mySpeciesAbund <- table(SymAS2[,1]) # identifies the mySpeciesAbun as the first column
mySpeciesAbund
Create a relative abundance matrix from the abundance matrix
scale the values in each column by dividing the values by the column total
taxaRel <- scale(SymAS2, center=FALSE, scale=colSums(SymAS2))
colSums(taxaRel)  # Check that the columns now all sum to 1 (=100%)
Lets add a new column Total that sums the abundances for each genus
dim(taxaRel)       # what is the current size/dimensions of the tables, rows and columns?
class(taxaRel)   # R handles matrices and data frames differently
taxaRel <- as.data.frame(taxaRel)  # convert it to a data frame, less efficient, but easier to use in tutorials
class(taxaRel)    # double check
taxaRel[,59]  <- rowSums(taxaRel)  # Add a new column that is the total abundance of each row
colnames(taxaRel)  # Check your column names
colnames(taxaRel)[59] <- "Total"  # Fix the new column name
colnames(taxaRel)  # Check again
head(taxaRel$Total)
rownames(taxaRel[taxaRel$Total >= 0.01, ])  # which are the abundant taxa?
sort(taxaRel$Total, decreasing=TRUE)  # Sort based on decreasing Total, and returns the values
order(taxaRel$Total, decreasing=TRUE)  # Sort based on decreasing Total, but returns the indices
sortedTaxaRel <- taxaRel[ order(taxaRel$Total, decreasing=TRUE) , ]
Box plots use the quartiles and outliers, so we want the taxa to be the x-axis and the samples to be the spread
t() will rotate the matrix for us
boxplot(t(sortedTaxaRel), cex.axis=0.75, main="Sorted Taxa", xlab=NULL, ylab="Relative Abundance", las=2)
matrix.taxaRel <- as.matrix(taxaRel)
heatmap(matrix.taxaRel, main="Common Taxa", labRow=Species, labCol=RRange)
ymAS2 <- read.csv("20140206_Moorea_OTUs.csv", header=TRUE, row.names=1, sep=",")  #read in sym "OTU" data with species and sample ID
SymAS2 # check data
read in enviornmental data
sampleInfo <- read.table("Moorea_Envt.txt", header=TRUE, sep="\t", as.is=TRUE)
sampleInfo  # look at it, does it look like it came in correctly?
class(sampleInfo)  # what type of object is it?
colnames(sampleInfo)  # what are the names of the columns / fields?
attach(sampleInfo)
head(SymAS2)   # quick check -- does it look okay?
rownames(SymAS2)  # check the names of the rows
colnames(SymAS2)  # check the names of the columns
SampleName  #  Notice that the sample names in the metadata file are in the same order as the column names!
Lets look at the abundances from the first sample (LOP_20110110)
head(sort(SymAS2[,1])) # what kind of abundances do we see?
?sort                       # what if I want to sort decreasing? Get help on the syntax also help(sort)
sort(SymAS2[,1], decreasing=TRUE)  # Rank abundance for the data, but it includes 0's
sort(SymAS2[SymAS2[,1]>0,1], decreasing=TRUE)  # Proper rank abundance with all the rows from cloumn 1 that are greater than 0
myRankAbund <- sort(SymAS2[SymAS2[,1]>0,1], decreasing=TRUE)  # Save the rank abundance for the first sample
table(SymAS2[SymAS2[,1] > 0 ,1])  # But John Bunge and real biologists prefer Species abundances, table provides the frequencies of each value (count)
mySpeciesAbund <- table(SymAS2[,1]) # identifies the mySpeciesAbun as the first column
mySpeciesAbund
Create a relative abundance matrix from the abundance matrix
scale the values in each column by dividing the values by the column total
taxaRel <- scale(SymAS2, center=FALSE, scale=colSums(SymAS2))
colSums(taxaRel)  # Check that the columns now all sum to 1 (=100%)
Lets add a new column Total that sums the abundances for each genus
dim(taxaRel)       # what is the current size/dimensions of the tables, rows and columns?
class(taxaRel)   # R handles matrices and data frames differently
taxaRel <- as.data.frame(taxaRel)  # convert it to a data frame, less efficient, but easier to use in tutorials
class(taxaRel)    # double check
taxaRel[,59]  <- rowSums(taxaRel)  # Add a new column that is the total abundance of each row
colnames(taxaRel)  # Check your column names
colnames(taxaRel)[59] <- "Total"  # Fix the new column name
colnames(taxaRel)  # Check again
head(taxaRel$Total)
rownames(taxaRel[taxaRel$Total >= 0.01, ])  # which are the abundant taxa?
sort(taxaRel$Total, decreasing=TRUE)  # Sort based on decreasing Total, and returns the values
order(taxaRel$Total, decreasing=TRUE)  # Sort based on decreasing Total, but returns the indices
sortedTaxaRel <- taxaRel[ order(taxaRel$Total, decreasing=TRUE) , ]
Box plots use the quartiles and outliers, so we want the taxa to be the x-axis and the samples to be the spread
t() will rotate the matrix for us
boxplot(t(sortedTaxaRel), cex.axis=0.75, main="Sorted Taxa", xlab=NULL, ylab="Relative Abundance", las=2)
matrix.taxaRel <- as.matrix(taxaRel)
heatmap(matrix.taxaRel, main="Common Taxa", labRow=Species, labCol=RRange)
load("/Users/hputnam/Publications/In_Prep/Primary/3_Moorea_NGS/RAnalysis/Data/1531 All OTUs.Rdata")
